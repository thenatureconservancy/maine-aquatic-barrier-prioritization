<script setup>
import { ref, onMounted, onActivated, computed, watch, reactive } from "vue";

/**GET STORE */
import { useSupportingLayersStore } from "../stores/supportingLayers";
const store = useSupportingLayersStore();
import { useFishPriorityStore } from "../stores/fishPriority";
const fishPriorityStore = useFishPriorityStore();
import { useGeographyStore } from "../stores/geography";
const geographyStore = useGeographyStore();
import { useInfoPopupStore } from "../stores/InfoPopup";
const infoPopupStore = useInfoPopupStore();
import { usePanelNavigationStore } from "../stores/panelNavigation";
const navStore = usePanelNavigationStore();
import { useFiltersStore } from "../stores/filters";
const filtersStore = useFiltersStore();
import { useExportStore } from "../stores/export";
const exportStore = useExportStore();
import { useAuthStore } from "../stores/auth"
const authStore = useAuthStore();

const label = ref(false);
function addGeogToDef() {
  let def = fishPriorityStore.def;
  //add the next few lines to the def and fix chane field name to hucs in def
  let geog = geographyStore.tab;
  let search = geographyStore.searchTerm;
  if ((geog == "huc8" || geog == "huc10") && def !== "" && search !== "") {
    def = def + " and " + geog.toUpperCase() + "_Name = '" + search + "'";
  }
  if ((geog == "huc8" || geog == "huc10") && def == "" && search !== "") {
    def = geog.toUpperCase() + "_Name = '" + search + "'";
  }

  let filterDef = filtersStore.def;
  if (def !== "" && filterDef !== "") {
    def = "(" + def + ") and (" + filterDef + ")";
  } else if (def == "" && filterDef !== "") {
    def = filterDef;
  }
  return def;
}
function getCount() {
  let def = addGeogToDef();

  const fishFields = [
    {
      statewide: "Alewife_Statewide_Tier",
      updateIndex: 4,
      huc8: "Alewife_HUC8_Tier",
      huc10: "Alewife_HUC10_Tier",
    },
    {
      statewide: "Coastal_Statewide_Tier",
      updateIndex: 3,
      huc8: "Coastal_HUC8_Tier",
      huc10: "Coastal_HUC10_Tier",
    },
    {
      statewide: "AtlanticSalmon_Statewide_Tier",
      updateIndex: 0,
      huc8: "AtlanticSalmon_HUC8_Tier",
      huc10: "AtlanticSalmon_HUC10_Tier",
    },
    {
      statewide: "BrookTrout_Statewide_Tier",
      updateIndex: 1,
      huc8: "BrookTrout_HUC8_Tier",
      huc10: "BrookTrout_HUC10_Tier",
    },
    {
      statewide: "ShadBBH_Statewide_Tier",
      updateIndex: 2,
      huc8: "ShadBBH_HUC8_Tier",
      huc10: "ShadBBH_HUC10Tier",
    },
  ];

  esri.mapView.whenLayerView(esri.layer).then((layerView) => {
    //fishFields.forEach((fieldName) => {
    const query = layerView.layer.createQuery();

    query.where = def;
    query.outStatistics = [
      {
        onStatisticField: "OBJECTID",
        outStatisticFieldName: "count",
        statisticType: "count",
      },
    ];
    //get outStatistics for min max fields
    //loop through fishFields and set up stats for min max
    //update fishPriorityStore with the min max values
    //re-rerun nest function? not sure if i need this
    for (let i = 0; i < filtersStore.json.length; i++) {
      let fieldName = filtersStore.json[i].attributeField;
      console.log(fieldName);
      if (filtersStore.json[i].variableType == "Continuous Range") {
        query.outStatistics.push({
          onStatisticField: fieldName,
          outStatisticFieldName: fieldName + "min",
          statisticType: "min",
        });
        query.outStatistics.push({
          onStatisticField: fieldName,
          outStatisticFieldName: fieldName + "max",
          statisticType: "max",
        });
      }
    }

    console.log(query.outStatistics);
    //query.groupByFieldsForStatistics = [fieldName[geog]]
    layerView.layer.queryFeatures(query).then(function (response) {
      let features = response.features;
      let obj = {};

      /*features.forEach((feat) => {
        obj[feat.attributes[fieldName[geog]]] = feat.attributes[fieldName[geog] + '_count']
      })

      fishPriorityStore.speciesSliders[fieldName.updateIndex].statewide = obj*/
      let format = new Intl.NumberFormat().format(
        response.features[0].attributes.count
      );
      fishPriorityStore.count = format;
      //update fishPriorityStore with min max values
      let rangeFields = response.features[0].attributes;
      for (let i = 0; i < filtersStore.json.length; i++) {
        let fieldName = filtersStore.json[i].attributeField;
         if (rangeFields.hasOwnProperty(fieldName + "min")) {
          if (!filtersStore.json[i].inUse) {
            filtersStore.json[i].modRange.min = rangeFields[fieldName + "min"];
            filtersStore.json[i].modRange.max = rangeFields[fieldName + "max"];
          }
        }
      }
    });
    // })

    layerView.filter = {
      // generates the where clause for filtering features
      where: def,
    };

    //update min and max on ranges
  });
}
function prepDataDownload() {
  let def = addGeogToDef();
  let fieldsList = exportStore.getFieldsList();
  console.log(fieldsList);
  esri.mapView.whenLayerView(esri.layer).then((layerView) => {
    const query = layerView.layer.createQuery();
    query.where = def;
    query.outFields = fieldsList;
    query.returnGeometry = false;
    //query.groupByFieldsForStatistics = [fieldName[geog]]
    layerView.layer.queryFeatures(query).then(function (response) {
      console.log(response);
      let features = response.features;
      let obj = {};

      exportStore.data = features;
      exportStore.jsonToCsv();
    });
  });
}
function changeGeography() {
  //clear
  //turn off all layers

  esri.huc8.visible = false;
  esri.huc10.visible = false;
  if (geographyStore.tab == "statewide") {
    //do nothing for now
  }
  if (geographyStore.tab == "huc8") {
    esri.huc8.visible = true;
  }
  if (geographyStore.tab == "huc10") {
    esri.huc10.visible = true;
  }
}
function updateRenderer(field) {
  if (field == "None") {
    esri.layer.title = "All Barriers";
    esri.layer.renderer = {
      type: "unique-value", // autocasts as new UniqueValueRenderer()
      field: "Type",

      //defaultSymbol: { type: 'simple-marker' }, // autocasts as new SimpleFillSymbol()
      uniqueValueGroups: {
        classes: [
          {
            // All features with value of "North" will be blue
            values: {
              value: "Crossing",
            },
            label: "Crossing",
            symbol: {
              type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
              style: "circle",
              size: 6,
              color: "#607d8b",
              outline: {
                // autocasts as new SimpleLineSymbol()
                width: 0.5,
                color: "white",
              },
            },
          },
          {
            // All features with value of "East" will be green
            values: {
              value: "Dam",
            },
            label: "Dam",
            symbol: {
              type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
              style: "square",
              size: 6,
              color: "#607d8b",
              outline: {
                // autocasts as new SimpleLineSymbol()
                width: 0.5,
                color: "white",
              },
            },
          },
        ],
      },
    };
  } else {
    esri.layer.title = fishPriorityStore.symbolizeByField.label;
    esri.layer.renderer = {
      type: "unique-value", // autocasts as new UniqueValueRenderer()
      field: "Type",
      field2: field,

      //defaultSymbol: { type: 'simple-marker' }, // autocasts as new SimpleFillSymbol()
      uniqueValueGroups: {
        classes: [
          {
            // All features with value of "North" will be blue
            values: {
              value: "Crossing",
              value2: 1,
            },
            label: "Crossing, 1",
            symbol: {
              type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
              style: "circle",
              size: 6,
              color: "red",
              outline: {
                // autocasts as new SimpleLineSymbol()
                width: 0.5,
                color: "white",
              },
            },
          },
          {
            // All features with value of "East" will be green
            values: {
              value: "Dam",
              value2: 1,
            },
            label: "Dam, 1",
            symbol: {
              type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
              style: "square",
              size: 6,
              color: "red",
              outline: {
                // autocasts as new SimpleLineSymbol()
                width: 0.5,
                color: "white",
              },
            },
          },
          {
            // All features with value of "South" will be red
            values: {
              value: "Crossing",
              value2: 2,
            },
            label: "Crossing, 2",

            symbol: {
              type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
              size: 6,
              style: "circle",
              color: "orange",
              outline: {
                // autocasts as new SimpleLineSymbol()
                width: 0.5,
                color: "white",
              },
            },
          },
          {
            // All features with value of "West" will be yellow
            values: {
              value: "Dam",
              value2: 2,
            },
            label: "Dam, 2",

            symbol: {
              type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
              style: "square",
              size: 6,
              color: "orange",
              outline: {
                // autocasts as new SimpleLineSymbol()
                width: 0.5,
                color: "white",
              },
            },
          },
          {
            // All features with value of "South" will be red
            values: {
              value: "Crossing",
              value2: 3,
            },
            label: "Crossing, 3",

            symbol: {
              type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
              size: 6,
              style: "circle",
              color: "yellow",
              outline: {
                // autocasts as new SimpleLineSymbol()
                width: 0.5,
                color: "white",
              },
            },
          },
          {
            // All features with value of "West" will be yellow
            values: {
              value: "Dam",
              value2: 3,
            },
            label: "Dam, 3",

            symbol: {
              type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
              style: "square",
              size: 6,
              color: "yellow",
              outline: {
                // autocasts as new SimpleLineSymbol()
                width: 0.5,
                color: "white",
              },
            },
          },
          {
            // All features with value of "South" will be red
            values: {
              value: "Crossing",
              value2: 4,
            },
            label: "Crossing, 4",

            symbol: {
              type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
              size: 6,
              style: "circle",
              color: "green",
              outline: {
                // autocasts as new SimpleLineSymbol()
                width: 0.5,
                color: "white",
              },
            },
          },
          {
            // All features with value of "West" will be yellow
            values: {
              value: "Dam",
              value2: 4,
            },
            label: "Dam, 4",

            symbol: {
              type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
              style: "square",
              size: 6,
              color: "green",
              outline: {
                // autocasts as new SimpleLineSymbol()
                width: 0.5,
                color: "white",
              },
            },
          },
          {
            // All features with value of "South" will be red
            values: {
              value: "Crossing",
              value2: 5,
            },
            label: "Crossing, 5",

            symbol: {
              type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
              size: 6,
              style: "circle",
              color: "blue",
              outline: {
                // autocasts as new SimpleLineSymbol()
                width: 0.5,
                color: "white",
              },
            },
          },
          {
            // All features with value of "West" will be yellow
            values: {
              value: "Dam",
              value2: 5,
            },
            label: "Dam, 5",

            symbol: {
              type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
              style: "square",
              size: 6,
              color: "blue",
              outline: {
                // autocasts as new SimpleLineSymbol()
                width: 0.5,
                color: "white",
              },
            },
          },
        ],
      },
    };
  }
}
function filterHuc() {
  let layers = esri.webmap.layers.items;
  if (geographyStore.tab == "huc8") {
    esri.huc10.definitionExpression = "1 = 1";
    if (geographyStore.searchTerm !== "") {
      esri.huc8.definitionExpression =
        "Name = '" + geographyStore.searchTerm + "'";
      //esri.layer.definitionExpression = "HUC8_Name = '" + geographyStore.searchTerm + "'"
      esri.huc8
        .when(() => {
          return esri.huc8.queryExtent();
        })
        .then((response) => {
          esri.mapView.goTo(response.extent);
        });
    } else {
      esri.huc8.definitionExpression = "1 = 1";
      esri.mapView.goTo(esri.webmap.initialViewProperties);
    }
    console.log("getshere");
  }
  if (geographyStore.tab == "huc10") {
    esri.huc8.definitionExpression = "1 = 1";
    if (geographyStore.searchTerm !== "") {
      esri.huc10.definitionExpression =
        "Name = '" + geographyStore.searchTerm + "'";
      //esri.layer.definitionExpression = "HUC10_Name = '" + geographyStore.searchTerm + "'"
      esri.huc10
        .when(() => {
          return esri.huc10.queryExtent();
        })
        .then((response) => {
          esri.mapView.goTo(response.extent);
        });
    } else {
      esri.huc10.definitionExpression = "1 = 1";
      esri.mapView.goTo(esri.webmap.initialViewProperties);
    }
  }
  if (geographyStore.tab == "statewide") {
    esri.huc8.definitionExpression = "1 = 1";
    esri.huc10.definitionExpression = "1 = 1";
    console.log(esri.webmap.initialViewProperties);
    esri.mapView.goTo(esri.webmap.initialViewProperties);
  }
  //getCount()
}
function updateDetails(obj) {
  infoPopupStore.details = obj;
}
function clearSelected() {
  if (esri.highlightP) {
    esri.highlightP.remove();
    esri.highlightP = null;
  }
  esri.DSTrace.visible = false;
  esri.USTrace.visible = false;
  updateDetails({ Site_ID: "" });
}
function showLabels() {
  label.value = !label.value;
  label.value
    ? (esri.layer.labelingInfo = [esri.labelClass])
    : (esri.layer.labelingInfo = []);
}
function onSelectSite(attributes, location) {
  updateDetails(attributes);
  //show upstream and downstream segments
  let Site_ID = attributes.Site_ID;
  let oid = attributes.OBJECTID;
  esri.DSTrace.definitionExpression =
    "Barrier_Site_ID = " + "'" + Site_ID + "'";
  esri.DSTrace.visible = true;
  esri.USTrace.definitionExpression =
    "Barrier_Site_ID = " + "'" + Site_ID + "'";
  esri.USTrace.visible = true;
  esri.mapView.whenLayerView(esri.layer).then((layerView) => {
    layerView.highlightOptions = {
      color: "#ffe700",
      haloOpacity: 0.9,
      fillOpacity: 0.2,
    };

    esri.highlightP = layerView.highlight(oid);
    navStore.tab = "info";
  });
  esri.mapView.goTo(location);
  esri.mapView.zoom = 12;
}
function getHistogram(RfieldName) {
  console.log("gets here");
  // getHistogramQuery(RfieldName)

  let data = [
    {
      fieldName: "batTotUSDS",
      min: 5,
      max: 5839166,
      steps: 10,
      data: [
        135616.41912469285, 133392.64396244567, 139233.07952198564,
        93385.55522896725, 23254.494900199923, 915821.7457844962,
        912885.1053217788, 55796.296397220605, 1652962.5997343238,
        188479.41251829505, 899164.7077198933, 3694.6675425189596,
        42614.13814657376, 1611897.2451982433, 376380.3820633807,
        1527665.1858541754, 1727.6075236885526, 10246.514560832738,
        30245.065540933967, 445574.0887281474, 17338.457004860345,
        1790.7720646507366, 52975.612559238485, 4310.992462819797,
        8158.358788200023, 679486.6987162527, 676681.6824869714,
        682780.669120122, 5315.908616327622, 131866.0598504702,
        154924.1795119189, 12919.278208915772, 1067820.3600885659,
        158453.4141436158, 9864.908882801416, 103517.47196976832,
        255006.71155804454, 341004.8053165476, 801437.9965009319,
        548953.305393812, 1615.2088143533094, 9178.867162801456,
        14580.062527201853, 1142815.1372519191, 120646.49207703175,
        3276.5145950511555, 330481.31820557854, 22514.406504080613,
        10736.873272059347, 296426.80040351785, 5901.029466153999,
        2243653.158171321, 3542.3697939276994, 6597.8193895518925,
        2770.4369361769595, 163265.5622015386, 67000.19749702059,
        52796.07577119837, 14399.648377182195, 3783.858024710463,
        14877.296794700487, 39023.62366045519, 1035.7486142248645,
        12182.157571734686, 22908.96677921366, 108594.02770323171,
        422847.49590857665, 341904.41908298305, 38710.72283931161,
        25722.98464264327, 51623.75054710328, 148078.36369959865,
        99793.126718525, 10685.976714022418, 657482.5260855829,
        832212.4903621699, 702549.0128569317, 112040.31341371196,
        46602.99278806094, 2910.8559832450933, 27057.429722890756,
        71281.69973259864, 926150.2283253726, 23372.80647273989,
        5208.310307547698, 11195.685454067725, 44636.298463119325,
        1133557.9927721876, 1125115.1239610827, 301098.60049463116,
        1183031.7954371301, 21469.94873313252, 29526.539347333328,
        923.9684111506327, 9940.769951494123, 211551.75811830713,
        22446.483241379607, 12546.279138807326, 311300.42914673424,
        284801.5047224439, 26921.02235814609, 51638.01927216995,
        10549.126263880002, 20250.099215100563, 36950.98069080895,
        452988.2450658023, 845987.5810351283, 107502.7920170287,
        81482.64351932853, 297499.729892596, 184441.48489318317,
        239.1470823725108, 28311.046364698585, 418.8675768357407,
        1161.9935769768942, 351805.8532864617, 71344.02843450716,
        126567.80729524794, 3313.740305313012, 286.9514265664329,
        37523.92740820902, 13940.85072045085, 8366.187404443974,
        21311.164192938068, 5684.886556009767, 1337.6014209416155,
        3489.2843872296157, 15648.010776348508, 1334.245786387342,
        57412.04630134804, 71158.68097811281, 2417.9270674394625,
        773.9985223725008, 10861.071930706305, 1458.697550858002,
        4522.5627987617445, 9400.626850338671, 2786.172404625508,
        2402255.575427166, 175.64129258015117, 9339.272740341139,
        45411.502588204115, 29801.115762972353, 15451.777988708367,
        22831.309521166466, 50608.79570496359, 11637.258039384298,
        7039.564669207028, 5568.605071053928, 3354.41579478758,
        1428.099724007577, 225488.35829012562, 9887.967604555217,
        440024.5964004374, 215201.39461351404, 789.5934066712638,
        165704.26383896772, 36991.26512864244, 870.6242436182554,
        913223.3374752952, 924283.2969543616, 2107.210748704866,
        145081.11579092266, 912941.6077804941, 41.385498972733615,
        4918.488748212541, 24469.47296351118, 19919.65506289814,
        132.4998192791179, 9620.16238096228, 66121.08393472187,
        27722.4101313785, 3523.898747971552, 674027.587666181,
        262058.56772701943, 10583.559121727885, 2028.2415563295322,
        80027.19519687642, 5097.778836303407, 83604.27325664934,
        2873.3452179537667, 1498051.2892830565, 8290.781801789104,
        1224.376442228168, 386587.8811285296, 7281.798604590149,
        37464.38915638979, 273645.0707838681, 4169.6264520224195,
        13955.159714460959, 37401.231381615406, 14111.522011768942,
        20918.44148676823, 27378.63850080754, 16899.475646587045,
        266.66373217012074, 80.85544767002432, 3419.323057651398,
        728677.1949700633, 42277.69377854746, 666464.5466454049,
        2645.6144460414775, 11190.933318799121, 119750.74850216508,
        5583.805076084149, 959779.013907684, 372322.50861344184,
        18214.761347914253, 94322.23003688865, 61587.17357724935,
        5941.005808706583, 133098.94771972878, 12176.304896296086,
        20789.36793763398, 10078.387480504247, 16973.10019063232,
        167330.8457851286, 308927.2340629805, 33025.096879322395,
        44808.483453803965, 248324.00177467757, 4735.60782038607,
        29162.41320342277, 4195.5675095728075, 38377.28471127183,
        1359.4121122651802, 25592.558572572292, 108694.64158332557,
        19224.722661196352, 93441.8713769722, 14386.658830091445,
        15269.605182854626, 8422.72322918945, 5676.970258299365,
        382.8787389394358, 3008.1623085141864, 7731.861379949726,
        750.6104883768793, 1898.9799765034218, 219214.38391487912,
        11540.645081688053, 4474.942450874241, 17266.88455593187,
        135907.83984825728, 13411.11564871135, 5310.714290928399,
        1538069.454068993, 2712.4756539124805, 10587.937424581665,
        128355.25994668776, 238224.98198483526, 3561.2925592543043,
        1199.6279641847036, 2349.594311908068, 1151.205140241136,
        225555.3315865862, 214905.20808764276, 1075.5699673891606,
        935925.7153060511, 208.43242996549245, 1098108.863167119,
        2465.7921383326016, 606.4826647769523, 50823.20734412961,
        130.68160834490538, 29175.84173404053, 1096824.0950326854,
        1154259.9184032248, 7587.2223211967885, 231644.43026564672,
        4827.584871798001, 74280.26192246212, 10719.43983986661,
        25724.224271109553, 41137.17081301038, 76462.2546776927,
        144418.52839035666, 813.5777641854907, 161130.49094555044,
        1463.5832269309658, 55627.98509527497, 2164448.5402340004,
        1533028.1917795732, 281141.959540928, 1560243.0714005542,
        88417.57120559775, 320406.7837903206, 241282.82043360412,
        702976.5873849988, 1502217.3310442914, 452408.01426951296,
        2408.7636374962553, 5585.223050338673, 937734.6291233269,
        1185.620490491214, 417.14585038903084, 14510.22780611064,
        574.7747486546575, 1458.7837860840568, 226769.80472326904,
        4075.148349062343, 116625.81793623335, 22151.62291522324,
        26886.18406525188, 26679.926560306398, 724.5849853441698,
        5835.319927364836, 19516.585286554222, 3554.933023810435,
        24360.865791226606, 835.9349044112995, 882.2353938697738,
        1171.4362330347258, 1632.5195726059585, 114672.03655060491,
        14504.784676435942, 543.5747474926094, 143168.66451786642,
        7262.848437994665, 18562.529733058407, 75891.49373713158,
        219212.2453989663, 418.0545346370816, 18945.87671282329,
        1182.7139648658992, 43442.22204690877, 179.47682510331083,
        5.573619768914807, 5781.292915607304, 40008.116530655825,
        42137.65674511932, 484.6041044316204, 4151.851169883451,
        4008.0785739287103, 206552.40423714166, 56365.22625976606,
        7932.348770026873, 15681.362975975788, 2001.7984430954516,
        95334.29960397631, 19420.503622538417, 53452.37422448907,
        174860.40475588432, 8671.681545488955, 18087.796943664227,
        11010.480568326155, 22967.018099899513, 418789.58228225855,
        239544.26894448797, 34720.90212610084, 34235.28619789167,
        5342.087379894764, 5418.39697439357, 9147.855174337528,
        922046.6895531851, 20173.12184235432, 3439.1180220820506,
        334891.6293001198, 380193.82316832535, 95213.2808838705,
        71845.05412870907, 18554.656555908467, 88318.73453153236,
        777378.6940577974, 777459.4111322827, 795118.5972023008,
        90157.91546501861, 960978.6258343454, 5490.509189974968,
        94091.58570055132, 125351.64178765909, 800608.0041024924,
        804319.4940639138, 810717.7450312587, 246756.43922050204,
        12907.003731994795, 666629.0281175486, 8236.952612098903,
        29345.0691969515, 348725.95346018893, 276.88097078363097,
        4745.375174659846, 1524.880963234612, 8436.471951796895,
        1608.8812451442031, 3678.734618389842, 4741.873303869921,
        9696.914936739524, 16750.189085677113, 2567.9307091201554,
        200299.1278954152, 6232.433432480792, 7283.242580674732,
        5199.591367622419, 9663.817386110619, 209518.59701682435,
        533818.6133192567, 4818.971199374547, 11599.532157387901,
        14188.710626228944, 1034462.1003972366, 112512.47501341533,
        950412.8227766355, 123755.95977557584, 10376.04718116856,
        12194.00676455167, 11189.85334226466, 10721.912844221395,
        3460.272407830746, 134274.62607877143, 14637.353435596553,
        12732.328103271133, 20761.29956134681, 48786.86289060073,
        3011835.4301731093, 3816.081139310497, 5039.835061550904,
        1736.9344883646033, 114.63857231802568, 48.245986628508255,
        14358.177299216175, 822.5047283768688, 271.4378001339806,
        10272.041581685835, 137.4472922232266, 655.8213270509503,
        891.0148117742463, 4101.13359574191, 45007.32486708023,
        23103.673123025663, 2974.7893648503496, 48170.92373224121,
        107026.71858459308, 5385.351546622121, 4887.512097246617,
        19971.065237399045, 6458.344473287436, 27869.485000471992,
        74483.24791149101, 1851.5813778503175, 30973.483999877342,
        11577.201727251475, 19162.290158766697, 75908.45307610584,
        44984.93376136571, 106442.29918518325, 20974.983683106566,
        7693.164492318056, 173928.13253217528, 22809.008627185493,
        48.29325031162816, 742.7460029538463, 1336.890768996614,
        11963.29064349554, 173319.74354161255, 2046.7670470147812,
        10045.71157384713, 21081.827887015737, 142979.383876406,
        198513.3642618801, 5228.389542348282, 6658.875561436038,
        288200.7909821406, 281184.0254469199, 2473.529906691902,
        5152.127595053629, 14054.285665099735, 6668.652789017911,
        33774.57554782141, 8084.900254127078, 20367.734341117997,
        63193.51280440453, 920250.9308793711, 920501.710005744,
        130126.25346707777, 43302.93214461307, 10833.083451287765,
        5255.670319549081, 1156476.5584989102, 219914.37340904726,
        608390.7864451155, 1716.5746234391727, 357936.0424170166,
        3473.0710231424273, 370468.87574691145, 1106.3404528464152,
        236530.893297593, 232908.05975126842, 16926.424295572506,
        220428.51784171106, 12049.307032231503, 236902.1570362362,
        903.8075030546547, 7522.334808914609, 327.6795847324223,
        4992.418645047778, 37916.45672317954, 21262.324598403735,
        226146.6621459116, 229416.7394076109, 40587.36781055284,
        165856.44577848123, 799162.8987473958, 686.2983170299467,
        14973.5556509628, 180625.8390292779, 5481.7017277665855,
        4706.0014395149, 914068.5317375299, 876557.1915286465,
        1097956.2186691386, 4021.3330876262667, 912755.2089106336,
        233.85644473434888, 595.4141587860111, 135.34150209745954,
        309.67148434098726, 327.8110906957893, 3567.9666481746485,
        17656.767256536812, 405.05380561832965, 587.2515795381152,
        25218.73505873466, 103655.3333789191, 365282.5812138276,
        8334.94482574895, 16418.607446986585, 623485.949952286,
        33632.81011633435, 123009.96168322745, 19798.040418207245,
        70130.1326126876, 115671.80546106081, 3010752.9059108607,
        1514104.172644418, 293692.5787719833, 25667.628329121144,
        20357.671228346342, 28263.55785171575, 12189.19815745816,
        996.5248165832671, 35486.613022824306, 80965.7060217955,
        26178.27721711346, 208267.99138786615, 26346.331980212603,
        228882.54445239334, 300354.2323037704, 10460.857579499141,
        3246.00283352645, 692039.0153571808, 768922.6322415518,
        1100666.8845127127, 1134060.2599447195, 1098178.5459451636,
        811718.0498326507, 433742.2698212974, 383865.9328984902,
        17650.990618433538, 15409.906055250685, 11355.340559726543,
        11342.804808126362, 3007622.3939643386, 1230.5123908384217,
        9390.382372167507, 1201.36978685314, 69302.59617537029,
        9567.348179874312, 3017607.0276081515, 3025488.3311468964,
        9963.800305425952, 3006656.700843333, 270301.8305290103,
        3327128.589428532, 293983.5861688385, 1065.6697844378107,
        119949.46632375309, 13241.199659150694, 51702.65416807819,
        107039.55813462955, 114687.0013875229, 44538.280949719796,
        12476.566076671259, 72403.804233226, 5895.471810815375,
        47270.71682558716, 132875.9402393074, 22171.677976390467,
        300667.6480588924, 508465.7622976965, 720946.9025524355,
        10464.796177223487, 8917.495548977739, 29037.82433732626,
        30346.275493085726, 2539.615012225806, 13880.424239408643,
        12696.650800807653, 27102.225075937724, 264383.99796364567,
        259489.92386171457, 15130.92118912253, 58974.48690438216,
        9705.592206538999, 823731.0250268544, 547825.6665195622,
        4274.327083295729, 26810.319362501443, 49022.83971158217,
        53805.20658181471, 168.83543750550692, 122807.71547002323,
        891.3546972090804, 29567.336272709825, 4241.567344900054,
        48151.987431837864, 2472.434065029266, 3195.0400433318223,
        493.7410983774727, 10575.070579063005, 3702.9180059074074,
        82.91818932382904, 45913.708549990224, 215200.97007099687,
        1012.5363732464817, 6159.743834020061, 9447.381911620107,
        41813.104096764924, 234365.396762361, 2445.304535139633,
        80726.77917254034, 3238.222528329694, 43589.90556693663,
        344.03403507261993, 13219.099301432281, 2085.2915537482827,
        1931.8450143663015, 13.452459686952318, 585.030376542533,
        3008621.0888591353, 122010.92217146377, 122056.90763784667,
        50166.26531586958, 228742.41922470156, 176324.71282752373,
        5766.302476183368, 2069486.1551465224, 176362.18709113158,
        208092.18452217808, 3789.7648906489503, 19942.65067323945,
        5537740.529552654, 5473256.313743692, 10021.5324063406,
        21950.65105735328, 23508.24175334555, 82560.07835326433,
        495.4091559188261, 41239.669432239825, 73048.04066941347,
        4585.014274978939, 293624.9511173732, 293851.67805834045,
        19829.078763842597, 1178.2588262210654, 326.40484658122824,
        272030.1147509391, 975164.8150411706, 1168433.1385772696,
        153094.40119354182, 1217898.3052911442, 269287.5660119726,
        39580.62570827103, 245143.0860291509, 11603.270095921307,
        42983.79696211267, 36150.49030096525, 108744.97077254299,
        217270.58730037106, 7244.614001630825, 701.0076614014525,
        403.86703910268113, 214750.79310924004, 17711.991048778284,
        35247.75970985685, 10086.24004635525, 4610.378635005459,
        8489.647416792275, 132904.7720828025, 51400.453547752775,
        102251.19563705909, 2749.1514065682304, 1290.4575395259576,
        91890.46941327756, 93843.94588444944, 49234.592764432855,
        102473.30411603054, 3304.5913762468535, 43913.09701165053,
        42200.57423134229, 52987.04571046195, 59219.33502603672,
        6542.051740693853, 4452.768533194835, 933.7023390582498,
        2359.7212953537355, 26802.67057299776, 19408.773802321164,
        15754.493044811521, 6146.765809549793, 97916.8074745805,
        11030.71510743341, 11255.003610646303, 4433.991806003001,
        177404.36932185624, 14180.19071737939, 14804.38568833062,
        2151668.4868151937, 2048143.415086492, 213542.91983092984,
        812509.0078128511, 84510.31932538087, 398089.0749447382,
        1573832.9878487359, 69.29811099128155, 8639.221825738641,
        62174.09785974563, 800185.1186085338, 1519312.7757028558,
        389.9422274947043, 48.09919592174549, 3508.292898012996,
        542082.2844727387, 800659.9693761372, 1290930.9540047108,
        65093.700682562136, 38046.67419975462, 587462.1418927849,
        14209.939800026374, 8610.15208610253, 86619.87762592846,
        6457.384051525964, 5351.2477260347005, 1505.2604803657225,
        2709.523014637416, 3678.3570281167163, 65592.9696198703,
        655.794393111284, 7848.8005265728925, 213.28531064663696,
        31417.91283343915, 75854.14596550199, 71349.98874932315,
        197.62880153381892, 50.417393926926835, 915.3494867755282,
        44.570457381445124, 494.73550326786744, 41.11535096424301,
        122.35037671057553, 3090.972298935318, 2434.5531830544855,
        29605.237520873983, 15923.036423827249, 10704.092136854157,
        1346.9107327797078, 36618.56284741206, 587274.3764212454,
        46990.22696246584, 58166.688061843415, 116891.4502059107,
        117133.34377066758, 588393.767726386, 2158.4234021456527,
        16698.30922050144, 629940.3211510467, 604555.7275420463,
        14616.759524082683, 93083.77638786759, 1613.4312792142732,
        28374.973474124006, 296906.66492062015, 31222.03678989171,
        12217.481176182218, 4228.11798376179, 20909.696668668526,
        9728.942880986824, 19932.890762632436, 128533.48470168859,
        1944.18156865314, 36709.87309140424, 25182.722077778977,
        5911.438554340131, 6176.02485911059, 2210.838501881627,
        2389.3576403890343, 3161.6709360213845, 4806.383513099451,
        2495.0374295839583, 17530.187612954353, 8190.918962871473,
        5211.181654718073, 1017.8485852860374, 525.391675844186,
        4745.171535873282, 74377.96237797369, 9109.51095346108,
        112596.72783092404, 50237.04144796093, 126981.9157657956,
        2050326.259513007, 162090.66380012315, 335.1256642448825,
        2468.12005844069, 3078.129300298586, 8503.120035433496,
        12856.539072032017, 9157.658617431203, 781.7422810547057,
        5998.004266072702, 7138.933404929274, 2462.6822568484554,
        17.849241288209527, 4416.560719095911, 18408.977218829703,
        12893.626740181486, 9426.920831052112, 690.4746349438761,
        3760.536405779513, 283.9629104169459, 5839165.921935888,
        639.7248662625083, 16856.416624473266, 10415.578558548907,
        3978.3675651431, 4322.942888099427, 19629.887282833803,
        268.17866458746795, 9942.700006510688, 2251.2410994625207,
        11658.439346753425, 2403041.1421293444, 11284.768446347287,
        2413.2802317829946, 101326.80454339602, 130880.95028259419,
        53508.02015244927, 23794.169615015828, 1933.4312114428167,
        212784.60496596014, 211694.135255885, 3810.758596199706,
        23746.294028397984, 52891.64839138608, 1137991.6299577397,
        2799.9310559183214, 2204.7131360902727, 44.22175980677144,
        511138.00754017767, 470.96851519464167, 559369.7486040023,
        80687.6389251134, 4733.72486784549, 379.3898332172967,
        3136.420427805066, 80693.63978674801, 2310.8301706751845,
        10798.582943309642, 2834.227036455272, 1977388.9931373168,
        2692.0934363217198, 6683.432610068841, 255.42355072216088,
        1532.939228448026, 43385.72123982601, 131970.65391040585,
        575.135125338305, 3537.6842869258994, 2728.3624660533114,
        3846.3262388255857, 4634.074228359592, 142708.33440627283,
        694.7856364243908, 1001.9778725494241, 16517.19072410569,
        251507.38169643073, 912933.5472195557, 19359.399880218865,
        14830.100992270805, 307.56612363431736, 2080.2130921587445,
        34244.37638014901, 1084.7442109438557, 934.4346225910685,
        68481.01434827343, 3158.4894708183824, 1891.527627067348,
        1097000.263194247, 1023.1420401959326, 1265.5505715324532,
        84484.47081390323, 39861.22361581809, 81366.97706258588,
        25264.163262854872, 325.1718074370194, 635.30955971675,
        1653.0487534565118, 209682.8794124135, 18709.125271163837,
        67206.2063283975, 58333.947467851576, 258674.8389244058,
        2586.007085959064, 309154.78707906767, 2032.1454880546635,
        187133.1129472176, 2074207.6653000435, 43161.3374351875,
        643.1118088440908, 532352.1215324175, 3012622.0091170147,
        1769.5921837500323, 16412.637704822955, 148297.06777314265,
        912896.2870329643, 10475.839330814768, 8345.261270275987,
        912805.8346337662, 913002.5332448053, 913040.744814671,
        27836.067194740714, 19544.192671335004, 207115.25990884626,
        13168.91798009913, 3573.9000870608133, 1693.2285554117782,
        2334.6601131173366, 2567.8653682988283, 2492.578581167648,
        1374.7784822038088, 28514.039796213463, 7124.192033675112,
        20752.83108474523, 34136.9723694878, 2879.579744977262,
        41689.27671594008, 611.6385372705527, 344.37612797132715,
        93389.4040430211, 599.4138699756672, 10632.55285715215,
        36099.704975811044, 712.453243228266, 1978713.2578682532,
        621.3343893897311, 1359.691709915603, 1537200.316874537,
        898.0942215275215, 170906.47729810938, 143693.78103866175,
        3684.647761992816, 8485.54221156878, 4130.385430006571,
        15107.484097597551, 755514.4696223768, 3535.599608711034,
        3007221.9262459893, 3749.8776520602214, 6411.671129498956,
        2153.461385163421, 49316.23790439874, 182672.49828993191,
        3915.3618220720186, 1513.9643825814007, 37041.990070718704,
        2497.8315559121893, 2676.6571729888356, 47591.97187032403,
        5706.745699280988, 101109.70165285683, 508235.55110138794,
        507267.2523358426, 4679.621521157283, 43318.2318530176,
        38206.42575541746, 15350.142364971069, 14066.851962496346,
        978.8235783530778, 9627.392795219825, 38135.53728980726,
        13823.806077685133, 914796.7904171194, 3869.62221804806,
        509851.7862300175, 507157.8236660349, 38934.09013869365,
        3678.6454155707233, 659.3594740999552, 35841.52100622139,
        913018.5529437109, 1501.1094509856675, 7813.573642662457,
        8474.749300597558, 1969.4862058791423, 36137.891636082226,
        913020.0513850955, 1476.2519397248166, 1682.8362025950516,
        9125.545314795918, 60717.15220094937, 37033.54087827586,
        948360.1111024575, 915973.5510969106, 49934.34603015478,
        912998.773920969, 915501.8634659648, 6968.442168182494,
        6405.433791008482, 915029.174297445, 15311.180496377841,
        913074.1862859403, 915090.6913020135, 8393.30018144542,
        919002.744640909, 915052.4228288613, 509092.09549117996,
        507835.294974459, 510037.8883839557, 509272.31710412947,
        507854.29214557604, 509007.5134303294, 507287.53349586704,
        5909.418466143283, 14113.311826121382, 11431.365417633902,
        914785.7213229724, 912993.4749143658, 1344.1257269492612,
        913137.9263808714, 916608.1825829716, 507422.66021242895,
        507480.4694003397, 508035.8512855963, 507994.34326449956,
        507603.7416189718, 507870.24567272374, 914317.3974418809,
        1819.1269030415217, 913114.099871985, 2052.5625208487127,
        913867.3278687139, 916005.8352879245, 28698.75472682539,
        17246.345219695257, 448882.0183409375, 420127.98514887015,
        419273.9914621301, 9426.955447894154, 9755.80449468737,
        31344.502415271905, 30236.28409707859, 30970.919587584285,
        29897.61036912907, 559385.0033039916, 1620.9468588315926,
        2019.6897435890355, 30085.284926510303, 559770.308910723,
        29418.983544581566, 1004.6486261509666, 2269.6758736989505,
        2950.861277140082, 506880.6839853595, 1383.0776791586013,
        3657.940888973593, 4233.217296262417, 4796.916241171552,
        2720.645075350365, 28784.327438354172, 4171.579363604747,
        40025.352852188546, 559704.251955744, 559565.7407316734,
        8864.99786318792, 17860.751396342108, 33173.68241114298,
        32844.567077818145, 422442.4342708319, 145072.71834876892,
        1225.7462615710235, 2755.9524834970734, 46729.14929852266,
        46947.20075683398, 564344.1344560323, 560072.2741683838,
        145826.27754818145, 4018.967840911288, 3855.8447399937304,
        559854.033337289, 507291.16589730466, 96691.7673745894,
        2631.71781701489, 206.78700015301456, 394.4680797463194,
        57972.77107801818, 1666.9442294918113, 1155.9197612907146,
        417549.1577716598, 5886.5447053328, 421118.2037679778,
        417484.19082345976, 3595.1505486721394, 258.04886052315646,
        36057.87123403812, 19466.34319482751, 420102.33951242693,
        35745.24629791461, 215059.3307941748, 2632.8757158244944,
        1175.4257981071182, 2057.0924457149194, 3214.3152065643285,
        61182.82893675259, 57408.89194209798, 7796.308951321523,
        10793.58395566407, 7814.778951718229, 8096.2658178658385,
        3049.9776942113594, 420736.6389107962, 3634.118121771779,
        6150.446724628859, 35680.73604014995, 198.08728804283328,
        2793.7774775119865, 2161.0284924527923, 1877.4368188389321,
        58308.004209140156, 4602.863671423776, 8226.915215558574,
        12615.911459572078, 2594.559800728287, 57368.82457620116,
        57028.37062283225, 58857.52663166166, 5236.2295901562675,
        7192.419733322731, 5968.287552657552, 465.2802907620067,
        5191.81051504723, 5761.521082543547, 4651.882451872517,
        57655.32168930939, 2110.356338172695, 3430.986002236759,
        4327.446950863258, 418.747285996825, 912898.931158961,
        916033.2849541003, 3407.2635505875614, 1865.8184287683698,
        7567.477205065716, 6609.082116793952, 3695.6680269505873,
        2448.1378222332805, 4143.6108342667885, 488.3162096679107,
        1694.50976270871, 1041.933793515208, 16949.944368920864,
        16317.53474010415, 1172.2907158990085, 6622.226213821421,
        17404.0218360887, 18033.943167327896, 7119.388453495107,
        42204.26973478753, 509809.52910387435, 946.4602003874194,
        507921.7024347725, 506831.27508704877, 63225.85629096984,
        86085.47024566529, 61255.51302015594, 62576.888429094084,
        155531.03908976892, 21462.574894704798, 146817.96784614204,
        147636.42739963366, 145258.61502278096, 145311.49727111263,
        17318.665154481594, 146560.35817666486, 1778.8064368073183,
        509507.88167604856, 1099076.0961692932, 1097163.31246212,
        4896.02741650971, 6499.6863093026805, 1100363.5267288967,
        8372.431395986847, 139.9019172041376, 1096748.6703280276,
        1103409.2584234956, 1100481.140461861, 1100493.7227927276,
        24297.3294522046, 25982.882548086025, 21972.653164903724,
        25560.55120019023, 23105.104957934578, 3659.8995790073623,
        7593.627156852372, 65746.35716502843, 41749.02309701362,
        67685.06650582667, 46173.55277841276, 4226.799635585518,
        1884.3535579004392, 1096872.8563027238, 607.1798483988184,
        1010.0115209674882, 1097008.1943510075, 1103095.83008536,
        1111136.2430260521, 1103047.3409902803, 9818.661757209251,
        1100503.1257232113, 1109148.5542437658, 1096939.7956585975,
        2374.558223275417, 1600.8469790559848, 1649.7650758659688,
        12268.156430847608, 26387.30897007122, 47966.614354110076,
        12363.05638128443, 11108.248127983265, 23600.920236211776,
        507269.24601536046, 87967.70228168057, 90249.55744875758,
        88418.32201591301, 14536.093082880117, 231.63307479568687,
        17197.283279476615, 18791.370396414884, 16466.314889323876,
        9212.453371534426, 9348.294239611081, 206534.65792378152,
        10401.138021375184, 1096888.242966431, 1113403.4746637894,
        11687.235263263925, 1291.2343978601673, 1097062.321751008,
        1096944.4905125136, 5648.151783710787, 1763.7857692868968,
        1803.6371890899698, 1831.6552039570413, 1097040.7002285866,
        1097057.836327377, 1572.077576463687, 30365.875173536446,
        11887.376760589794, 5072.366245704055, 421570.2781728925,
        7710.385409912328, 10407.328932971443, 8679.243199624132,
        9443.951738582946, 213726.00529089314, 208353.0742977114,
        211394.36865127087, 207883.2549123831, 1530.8179307596454,
        206349.59365397113, 207490.06374630402, 206211.5050384078,
        20063.749532382815, 13162.625328345577, 33021.84117601661,
        7425.3654954166805, 5747.747332102556, 1565.5616454029723,
        3609.2997379240123, 5298.233196387909, 28526.8642206568,
        30060.442069015116, 5500.388359122247, 1096827.117220116,
        658.7154940503823, 1097121.088688898, 111964.77691511909,
        113567.81309763069, 1472.9906243885835, 2371.4459544058864,
        184433.00507707012, 184646.01436736784, 112986.95848082143,
        112346.62013297975, 912895.7833606084, 913024.370348861,
        913687.7450348138, 4400.519658213333, 914349.683822363,
        913877.0430697867, 913641.6121375381, 913074.5212916172,
        914896.958676665, 227641.81080256568, 14050.288172296332,
        150.26006210155884, 679.6088159492617, 100219.08929735274,
        329.1527227559746, 417491.0959749784, 2459.8252762130082,
        418558.72701474314, 1789.3458476071803, 6141.7780212539565,
        418219.2248976999, 421036.7371532039, 11169.954666695594,
        2694.1964523134957, 2085.4156973242684, 166751.80108576766,
        172627.0223488415, 167508.98842155468, 166962.3919719328,
        2382.998054706188, 21908.810409863225, 1099345.635244704,
        3005.1794716361364, 12809.94888187998, 2300.109083946907,
        351.02662740937546, 1293.5266440239893, 417530.7510706085,
        418619.86624140537, 418073.776114223, 12034.125706854575,
        418031.8130758295, 1127.3334005104584, 418233.97757589974,
        426764.633266435, 17845.28465648944, 9657.911832572427,
        244.98283908303995, 420666.8064823415, 417979.0120399681,
        11198.205903847569, 167938.8033215528, 167677.45720188026,
        167637.1479759187, 167586.51064551758, 173866.55161493202,
        167860.93721097475, 3006817.134292921, 3009416.419926596,
        3007455.8346753307, 3014214.132087581, 3007442.5229614843,
        2510.8558319360536, 3460.839300001147, 3011739.6178623647,
        565.3619697045265, 3008461.7173265093, 3007573.003583533,
        1932.1667248877955, 270.1540323725555, 3006627.247593977,
        3009109.558236526, 8392.295682774855, 11320.111525893748,
        433.6853491300514, 726.9801988157931, 472.5413060240406,
        1461.0613942906728, 1096874.0916403849, 1452.0710894518274,
        421943.75770689436, 6106.461840864267, 1560.1689860127808,
        4097.485045222445, 312141.3399478977, 8701.176465935227,
        8401.213018122027, 10640.04136798509, 311713.56917814404,
        2145.854054669596, 16545.694783150393, 308688.13526512147,
        1427.1952519568083, 3550.1524359702858, 3373.958141129672,
        112797.59984378499, 112127.9736743774, 313340.62674642523,
        311512.28000704374, 169017.76752752127, 309812.87635281443,
        312603.1371160154, 314630.2728112944, 318040.95300582825,
        309754.93022782524, 308728.4100330122, 308614.4052368233,
        3314.072344859818, 308531.75105801085, 880.8157148900384,
        310344.69607345655, 2412.2187028354947, 308807.0777425361,
        309464.5918926421, 310504.41556495725, 319021.85710783035,
        308652.11392921326, 1210.506325584489, 309634.618188392,
        309339.94410633115, 309855.53129113134, 309452.41105797427,
        5751.247818057186, 315756.2770743505, 310941.6800202557,
        315322.7665441939, 5776.557880078371, 5904.923532662839,
        114456.77693443827, 3010308.3628247133, 3008614.647673157,
        310035.28669739136, 3027.213686729768, 3523.923519276704,
        1285.183417983772, 309374.4981054056, 8350.960767227383,
        88529.6632959699, 1260.4096019139843, 8545.068366355372,
        2113.218623538025, 8826.635759222932, 10379.278096220898,
        8729.91432618636, 2749.4788039833375, 22657.626136679635,
        16119.792390711165, 16711.633378538547, 4830.975366164406,
        6609.504035823517, 8391.059041494635, 314304.3056708378,
        5074.881952254147, 5106.611730814703, 11016.940146502624,
        89800.15278276714, 183849.06376011908, 167822.82509523828,
        167848.12501970414, 2880.7128191010534, 844.2562041096281,
        171476.78506297682, 172348.07469822373, 167415.8385502422,
        1179.5327906897376, 308903.40824828943, 1828.64862990848,
        2260.1080865568515, 308538.9954278472, 310825.97001466283,
        310129.9035531677, 309291.46573962935, 8763.258202962292,
        9763.776536408735, 9936.122666460109, 2008.6073843007139,
        7202.044608373566, 8204.232766752382, 4408.852235674181,
        918.5379307581118, 1868.801137724832, 4894.926743435428,
        3033516.217590794, 3010011.0242319186, 7090.199282539721,
        2548.6297290049724, 15085.307703955306, 1072.562825161858,
        214746.92951809018, 34041.68711480248, 186248.21756271712,
        88532.64711132432, 89858.52725544994, 167782.8700596694,
        361.8980706770262, 182895.82069269972, 191413.71192742963,
        167320.95009555478, 92882.05132971554, 88460.51921885427,
        12262.123330234528, 19326.896814354535, 21056.853224630442,
        3122.6582610047926, 19529.692464481675, 19851.625483262113,
        19066.621349436813, 20259.610330966996, 7636.348004577536,
        13174.493327049586, 9957.703651580496, 314537.116934783,
        7195.77572312454, 7257.405466363932, 314868.1773175752,
        310623.81921511027, 3463.8034805951047, 310630.66086964775,
        309206.46702505404, 312836.9530909196, 309254.15721119556,
        309059.4152898681, 13803.548614313775, 3854.997136895967,
        2530.876803575872, 4470.730647761139, 20608.64288672021,
        309451.0557293461, 7719.915911525856, 1963.4297718626417,
        2357.3500621734815, 168357.03276422276, 175295.35334481244,
        3008202.9688899186, 3013384.614485636, 1273.2193913410497,
        3007137.487161813, 1358.7992729451557, 308614.222440458,
        308593.8977250588, 743.3116427134682, 2816.0322254338216,
        1675.6450697665655, 309660.42236173095, 308509.2180546023,
        893.7804608701503, 398.8086095204869, 311094.1986180317,
        801.0000605312471, 1308.62877067733, 805.3858821881568,
        4889.474643047122, 5060.109145277243, 314732.8192586112,
        89078.24710470028, 89067.20995925162, 507520.16482015664,
        3012762.822016063, 1379.6305793041922, 421.2565093413548,
        5588.965013497913, 2903.8987163444344, 1642.1473818100446,
        3008061.453590151, 1110.9316739778244, 511.0180437986413,
        1493.6341565159898, 4684.6640361095415, 411.74266084093676,
        1526.6775555441166, 6941.703861423449, 16619.937860856677,
        156.0349095266796, 3445.802196362834, 3474.275453189656,
        5658.8799163936155, 2348.4930122421015, 9364.922577751358,
        5588.791544348418, 358.0911245128325, 912787.6480429618,
        2303.8459924139497, 2144.4003289126176, 3007695.426089038,
        1466.3121418277067, 1380.5379398037528, 1048.5356058608234,
        1818.9667246196937, 1795.199973826205, 5558.031435279283,
        8636.642863760408, 6938.477089927073, 8353.46271159807,
        4486.572239824745, 7652.168159980418, 7897.616967579899,
        5152.259317048809, 169053.14365135354, 834.6411041733797,
        5779.827509727731, 309911.06228563306, 3485.1374884437446,
        3007322.8930973886, 3012117.457528298, 449.4703917730261,
        308828.27821615175, 310238.44602637546, 309977.2470308006,
        2165.2468735668754, 3010937.0702977316, 308965.82801065734,
        2705.6453295732763, 4943.126737538172, 4069.8375145113487,
        6091.26135288213, 3007938.603416937, 3010492.0120655834,
        3008570.3458538377, 1529.7770155449334, 308561.1911133222,
        167295.84509049414, 1535.1783449779741, 168560.92498344215,
        1491.4520682256357, 167462.73549153833, 1706.4191204980364,
        1353.1802133927972, 256.36883263504916, 3451.3833126365307,
        167481.57193045627, 167464.447945352, 167701.3797921158,
        167522.92459161073, 167677.502734608, 167318.35642351248,
        167042.809621201, 3007879.1460759304, 3007502.524874327,
        3995.925350539976, 3007445.1434594668, 3007627.508178355,
        3006622.1288193064, 891.5410676137379, 313404.60131354496,
        3927.5800472406763, 883.0779455857672, 118.03575730625411,
        6423.028711198094, 3009845.797843323, 1306.2681529414963,
        3008933.157031277, 3008672.1081486586, 1378.3020747783592,
        309302.6022808736, 8093.779235325872, 309430.6561216493,
        312237.9475243653, 690.993130452834, 3065.664553980744,
        3009601.882938879, 889.819395165416, 360.7696461260024,
        3007827.4603405953, 3007870.9190942477, 19729.59874651865,
        2704.2208978079952, 3008782.7953968775, 3011343.614180823,
        3009347.717883784, 3009411.6977399583, 21299.751085556753,
        23522.75554469261, 20167.075068781684, 309384.6406567733,
        3011353.0039064153, 1538.728197765687, 52.22027332883122,
        2656.690356183141, 3006685.4964317884, 3007356.223709552,
        3008090.5714114984, 3008248.8942764155, 3006685.185707958,
        3007112.910704392, 3006642.9765146994, 3007478.717399698,
        310757.3395846142, 4055.1013328106746, 654.4026629161103,
        310986.36382075556, 668.2182971791328, 308811.2351038586,
        1718.7820882625488, 3007091.9666969683, 1453.0281145878744,
        1699.0913284282692, 3007386.5710538006, 3007493.035457832,
        3007387.392969003, 2958.374274347114, 5936.1053440535225,
        5881.8142590930365, 6084.691036140912, 28003.808815947534,
        31598.66667130939, 44603.635999740225, 5865.600365743791,
        2284.2888399801054, 33272.1554411995, 17099.846421153277,
        150043.54187329137, 1504.9830197590802, 149626.10878057234,
        4020.6016413389752, 4583.607601500117, 10397.369447203562,
        137.36306505504132, 2115.3426601628853, 3535.5321090805983,
        11130.280360241655, 616.8231173956292, 7963.843793675215,
        10719.534562342955, 8088.532793219188, 2332.2814368563154,
        7948.147469876115, 7473.740519000716, 14351.177133283189,
        1493.9474627746567, 1498877.3459586843, 309989.54753551993,
        309895.62124304543, 308558.61525543255, 1955.783363136782,
        718.5723653452017, 3564.344118615916, 282.0905576146477,
        140.03338044091345, 1498176.6722940775, 16616.765100768956,
        29668.172122310934, 2076.3207203332013, 11028.608530882026,
        3025.4809357196755, 1105.5438856078697, 3007479.957904837,
        3872.6996637435955, 1692.407775408135, 5465486.928761479,
        5465730.316863353, 5465249.551831663, 5467867.601670202,
        515.1927045257596, 5468026.686988787, 1538.2698904702831,
        5466076.734868014, 5468094.432120022, 5465656.390208842,
        1095794.3481858417, 39540.22070341389, 913885.0517237016,
        91659.27547450401, 214504.30486997133, 215243.24866948606,
        508570.3168668618, 11431.985583367108, 1097658.1520898978,
        1097407.3735721542, 16067.121719060004, 560632.9748531106,
        29524.236194774345, 368.6285857902279, 1545.320862804387,
        3008189.9341396405, 1523.440372239249, 312087.5729594694,
        626.5871973408535, 89637.28868671897, 91401.22877410665,
        980.1316286159185, 182822.3580397004, 113940.45712464393,
        182883.92288318957, 14136.552320326306, 88893.43803052981,
        183657.42458105058, 30675.300350011443, 206308.23559105064,
        10107.804417062127, 3138.126647392779, 418294.5025660459,
        913392.1223854948, 87881.95095181586, 1096985.5827067492,
        38594.132024702565, 1096407.5543625164, 1095705.1891487143,
        4087.3203522606764, 21254.398833140138, 10908.626375042555,
        1015.5082663208557, 308988.6645266686, 713.746562107927,
        1298.4101245795744, 310471.81547404826, 312041.1761948739,
        309560.299865517, 309193.5424579369, 310534.9491138771,
        309374.4858280523, 308874.4100567074, 1014.7549743507951,
        310124.87345877074, 308767.51316320774, 309516.72368556244,
        310797.4976774675, 5608.981649815724, 5366.5760221268865,
        2392.9683784383556, 308645.438911792, 4869.210823550396,
        309130.1957959366, 310010.82777521823, 2469.012706571324,
        3052.8771640412033, 732.114625925953, 1095658.342485427,
        1096259.8380664766, 1097034.7874673265, 1096618.8346787696,
        1081.7447691302355, 1095834.6999161453, 1752.5521658601929,
        1096513.58388896, 1095903.4039873427, 1102587.6443196598,
        8132.543944998575, 5525.482515445963, 41623.76489249341,
        320.62741852443713, 2141.9522939071453, 2446.1222398375367,
        2154.0782656928977, 2441.9353627521937, 4822.599330709591,
        2298.0325392068007, 3977.0003574073726, 447.3548419119419,
        265.50695831786834, 1124611.6040043612, 1123798.0478201609,
        1123833.461797321, 1125700.2157212696, 1123287.7263260912,
        1123071.9025528836, 820.1845703854358, 315784.9267734893,
        309770.043620224, 316275.9945818576, 312454.79117591714,
        320150.3060329357, 8287.43971987686, 16070.430934820177,
        9885.417982809406, 4667.436502477049, 20215.727437243506,
        19532.202581541733, 929.4014358320635, 2300.170689525572,
        524.1992050135849, 1600.4965227081182, 904.3715649160271,
        3617.7510258690036, 2691.188388043766, 6308.876965806424,
        1195.1011087575232, 19770.187633894304, 11551.774183878199,
        1373.0305155963154, 1116.387987826781, 11380.682953739222,
        766.9270747625077, 188.93030231047322, 1178.4154612874452,
        580.0904968095599, 12242.25816339581, 5336.472005127117,
        5887.236174143809, 51.836396061365576, 5028.928584510271,
        793.4527526517179, 32581.501951891274, 806.057234196795,
        723.7781758632228, 1436.8689666845564, 32052.83319288794,
        180.46662052722814, 351.00781438215176, 581.4673512118634,
        735.4317367948622, 1209.8101134763715, 1167.6038290913098,
        1066.5372649591586, 924.3618944881208, 206.40284477885652,
        854.0189191729326, 539.397750356349, 1085.6165279332743,
        868.8888321855319, 930.674919061044, 1941.2574617010432,
        1215.4353836672867, 826.8434188626276, 940.9293171405136,
        493.3981677440298, 1852.3476134004238, 947.3500038517275,
        484.97978402953567, 189.23468314723004, 614.7985547950276,
        711.4098313494948, 364.65867009845226, 1076.13338722427,
        1836.5078292994633, 2046.4147485802316, 6551.112007133175,
        707.3626764408509, 1204.7590148351749, 1841.0991716810724,
        1151.979438629757, 383.2635679488046, 1690.015052348288,
        32697.892399474906, 1038.8482494307013, 1123.0428367800232,
        1092.3882119932503, 371.7599487543889, 19206.12078809092,
        752.7910368347872, 1565.445982741439, 695.5936427991072,
        1196.7531813183411, 10239.190917949914, 10164.861593850503,
        721.4932234339082, 8610.82403157297, 971.1329743006434,
        1485.2040893047229, 8364.606458283868, 833.7335352654745,
        3870.557892853344, 333.20242368675264, 2633.4087242420155,
        997.6643025765011, 6003.491798370269, 2036.3566688296578,
        9626.06173177731, 4554.477112837255, 10286.726317619139,
        2556.2941031364976, 10099.192567333332, 11257.907524224172,
        1959.5001215995148, 1066.2104006120778, 609.2153441321877,
        146.10185682791, 1598.1108325571645, 2136.600432641935,
        1641.7167912095438, 2952.5531554048007, 2751.4479702665535,
        8725.20251104543, 2512.6004749507883, 2592.471317764159,
        2420.3332634783515, 7117.61282455417, 11188.051594332555,
        4186.623783680452, 4576.949027220329, 3217.931430231544,
        3008470.9678849857, 3008561.3956941986, 3053.450775987341,
        3006913.983546317, 4726.319009807444, 3008503.048085427,
        3007321.9707821794, 3015041.426469585, 9305.142245600031,
        3007386.7754729483, 10088.147232597243, 9629.985946616382,
        1424.0639921581926, 8580.831258433747, 4232.127078173571,
        10437.683507553253, 3009536.7966530677,
      ],
    },
  ];

  let fieldInfo = data.find(({ fieldName }) => fieldName == RfieldName);
  if (fieldInfo) {
    getHistogramChart(data[0]);
  }
}
function loadSecureData(){
  //esri.layer.url = "https://services.arcgis.com/F7DSX1DSNSiWmOqh/arcgis/rest/services/INTERNAL_AllPrioritized_Barriers/FeatureServer"
  
}

//uncomment and run this function from getHistogram if you need to get updated query data for the histogram.  the results print to the screen and can
//be coppied into to the data object above. The data is currently hard coded.
/*function getHistogramQuery2(){
  'https://services.arcgis.com/F7DSX1DSNSiWmOqh/arcgis/rest/services/AllPrioritized_Barriers/FeatureServer/0/queryBins'
  let query =
}*/
function getHistogramQuery(fieldName) {
  let query = esri.layer.createQuery();
  query.where = "1=1";
  query.outFields = [fieldName];

  esri.layer.queryFeatures(query).then(function (response) {
    let vals = [];
    for (let i = 0; i < response.features.length; i++) {
      vals.push(response.features[i].attributes[fieldName]);
    }
    console.log(fieldName);
    console.log(vals);
  });
}
function getHistogramChart(fieldInfo) {
  console.log("gets here");
  let fieldName = fieldInfo.fieldName;
  let vals = fieldInfo.data;
  let steps = fieldInfo.steps;
  let min = fieldInfo.min;
  let max = fieldInfo.max;
  let data = histogramBins(vals, steps, min, max);
  console.log(data);
  //const ctx = document.getElementById('hist-id-' + fieldName).getContext('2d')
  //const ctx = document.getElementById('hist').getContext('2d')
  /*const chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: data,
      datasets: [
        {
          data: data,
          backgroundColor: ['rgba(202,221,238, 1)'],
          borderColor: ['rgba(202,221,238, 1)']
        }
      ]
    },
    options: {
      responsive: false,
      legend: {
        display: false
      },
      elements: {
        line: {
          borderColor: '#000000',
          borderWidth: 1
        },
        point: {
          radius: 0
        }
      },
      tooltips: {
        enabled: true,
        yAlign: 'top'
      },
      scales: {
        yAxes: [
          {
            display: false
          }
        ],
        xAxes: [
          {
            display: false
          }
        ]
      }
    }
  })*/
}
function histogramBins(data, size, min, max) {
  /* let min = Infinity;
  let max = -Infinity;

  for (const item of data) {
    if (item < min) min = item;
    else if (item > max) max = item;
  }*/
  console.log(data, size, min, max);
  //const bins = Math.ceil((max - min + 1) / size)
  const bins = 10;
  const histogram = new Array(bins).fill(0);

  for (let item of data) {
    if (item > max) {
      item = max;
    }
    histogram[Math.floor((item - min) / size)]++;
  }

  return histogram;
}
function esriHistogram(field) {
  histogram({
    layer: esri.layer,
    field: field,
    sqlWhere: "1=1",
    numBins: 10,
    maxValue: 60,
    minValue: 0,
  }).then(function (histogramResult) {
    console.log(histogramResult);
    let arr = [];
    for (var i = 0; i < histogramResult.bins.length; i++) {
      arr.push(histogramResult.bins[i].count);
    }
    console.log(arr);
  });
}

const esri = {
  mapView: "",
  supportingMapLayer: "",
  legend: "",
  map: "",
  measurement: "",
  lgExpand: "",
  search: "",
  layer: "",
  webmap: "",
  highlightP: "",
  details: "",
  USTrace: "",
  DSTrace: "",
  huc8: "",
  huc10: "",
};

/**WATCH */
watch(
  () => fishPriorityStore.def,
  () => {
    getCount();
  }
);

watch(
  () => filtersStore.def,
  () => {
    getCount();
  }
);
watch(
  () => fishPriorityStore.symbolizeByField,
  () => {
    updateRenderer(fishPriorityStore.symbolizeByField[geographyStore.tab]);
  }
);
watch(
  () => store.state.treeState,
  () => {
    updateSupportingVisibility();
  }
);
watch(
  () => store.state.opacity,
  () => {
    updateSupportingOpacity();
  }
);
/**geography store */
watch(
  () => geographyStore.tab,
  () => {
    changeGeography();
  }
);
watch(
  () => geographyStore.searchTerm,
  () => {
    filterHuc();
    getCount();
  }
);
//export store
watch(
  () => exportStore.getDataDownload,
  () => {
    prepDataDownload();
  }
);
//auth store
watch(
  () => authStore.userAllowed,
  () => {
    loadSecureData()
  }
)
/**IMPORT ESRI LIBS */
import Map from "@arcgis/core/Map";
import MapView from "@arcgis/core/views/MapView";
import MapImageLayer from "@arcgis/core/layers/MapImageLayer";
import Legend from "@arcgis/core/widgets/Legend";
import Measurement from "@arcgis/core/widgets/Measurement";
import Expand from "@arcgis/core/widgets/Expand";
import BasemapGallery from "@arcgis/core/widgets/BasemapGallery";
import FeatureLayer from "@arcgis/core/layers/FeatureLayer";
//import ScaleBar from "@arcgis/core/widgets/ScaleBar";
import Portal from "@arcgis/core/portal/Portal";

import * as identify from "@arcgis/core/rest/identify.js";
import IdentifyParameters from "@arcgis/core/rest/support/IdentifyParameters.js";
import * as reactiveUtils from "@arcgis/core/core/reactiveUtils.js";
import WebMap from "@arcgis/core/WebMap.js";
import LayerList from "@arcgis/core/widgets/LayerList.js";
import Search from "@arcgis/core/widgets/Search.js";
import Point from "@arcgis/core/geometry/Point.js";
import histogram from "@arcgis/core/smartMapping/statistics/histogram.js";
onActivated(() => {
  console.log("activated");
});
onMounted(() => {
  console.log("mounted");
  console.log(esri);
  // Portal IDs for TNC Basemaps. Use any id to set the map's basemap.
  //const tncHillshadeMapId = 'd22aed9a4acb4bc8ae8f2141732af496'
  const tncDarkMapId = "1f48b2b2456c44ad9c58d6741378c2ba";
  // const oceansMapId = '67ab7f7c535c4687b6518e6d2343e8a2';
  // const hybridMapId = '86265e5a4bbb4187a59719cf134e0018';

  //select a basemap
  /* esri.map = new Map({
    basemap: {
      portalItem: {
        id: tncDarkMapId
      }
    }
  })*/
  if (esri.webmap == "") {
    console.log("here");
    esri.webmap = new WebMap({
      portalItem: {
        // autocasts as new PortalItem()
        id: "e301a33e8667412abe497c329ad581d1",
      },
    });
  }

  //create the map view
  if (esri.mapView == "") {
    esri.mapView = new MapView({
      map: esri.webmap,
      //center: [-70.99501567725498, 42.310350073610834],
      container: "map",
      navigation: {
        browserTouchPanEnabled: false,
      },
    });
  }
  let layerList = new LayerList({
    view: esri.mapView,
    container: "layerList",
    dragEnabled: true,
    visibilityAppearance: "checkbox",
  });

  layerList.visibleElements = {
    catalogLayerList: false,
    closeButton: false,
    collapseButton: false,
    errors: true,
    filter: false,
    heading: false,
    statusIndicators: true,
  };

  //console.log(webmap.layers.items)
  /*esri.webmap.when(function () {
    let layers = esri.webmap.layers.items
    for (let i = 0; i < layers.length; i++) {
      layers[i].visible = false
      esri.layer.visible = true
      esri.layer.title = 'All Barriers'
    }
  })*/

  // 
  esri.layer = new FeatureLayer({
    url: "https://services.arcgis.com/F7DSX1DSNSiWmOqh/arcgis/rest/services/AllPrioritized_Barriers2025/FeatureServer/0",
  });
  esri.layer.outFields = ["*"];
  esri.layer.listMode = "hide";
  esri.webmap.add(esri.layer);
  esri.webmap.reorder(esri.layer, 100);
  esri.layer.renderer = {
    type: "unique-value", // autocasts as new UniqueValueRenderer()
    field: "Type",
    visible: true,
    uniqueValueGroups: {
      classes: [
        {
          // All features with value of "North" will be blue
          values: {
            value: "Crossing",
          },
          label: "Crossing",
          symbol: {
            type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
            style: "circle",
            size: 6,
            color: "#607d8b",
            outline: {
              // autocasts as new SimpleLineSymbol()
              width: 0.5,
              color: "white",
            },
          },
        },
        {
          // All features with value of "East" will be green
          values: {
            value: "Dam",
          },
          label: "Dam",
          symbol: {
            type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
            style: "square",
            size: 6,
            color: "#607d8b",
            outline: {
              // autocasts as new SimpleLineSymbol()
              width: 0.5,
              color: "white",
            },
          },
        },
      ],
    },
  };
  esri.labelClass = {
    // autocasts as new LabelClass()
    symbol: {
      type: "text", // autocasts as new TextSymbol()
      color: "#28343a",

      //backgroundColor: [213, 184, 255, 0.75],
      //borderLineColor: 'green',
      //borderLineSize: 1,
      //yoffset: 5,
      font: {
        // autocast as new Font()
        family: "Playfair Display",
        size: 10,
        weight: "bold",
      },
    },
    labelPlacement: "above-center",
    labelExpressionInfo: {
      expression: "$feature.Site_ID ",
    },
  };
  esri.layer.labelingInfo = [];
  esri.USTrace = new FeatureLayer({
    url: "https://services.arcgis.com/F7DSX1DSNSiWmOqh/ArcGIS/rest/services/US_TraceLines2025/FeatureServer/0",
    visible: false,
    definitionExpression: "1=1",
    legendEnabled: false,
    listMode: "hide",
  });
  esri.webmap.add(esri.USTrace);
  esri.USTrace.effect = "bloom(1.5, 0.5px, 0.1)";
  esri.DSTrace = new FeatureLayer({
    url: "https://services.arcgis.com/F7DSX1DSNSiWmOqh/arcgis/rest/services/DS_TraceLines2025/FeatureServer/0",
    visible: false,
    definitionExpression: "1=1",
    legendEnabled: false,
    listMode: "hide",
  });
  esri.webmap.add(esri.DSTrace);
  esri.DSTrace.effect = "bloom(1.5, 0.5px, 0.1)";
  esri.huc8 = new FeatureLayer({
    url: "https://services.arcgis.com/F7DSX1DSNSiWmOqh/arcgis/rest/services/HUC8Watersheds_Maine/FeatureServer/0",
    visible: false,
    definitionExpression: "1=1",
    legendEnabled: false,
    listMode: "hide",
  });
  esri.webmap.add(esri.huc8);
  esri.huc10 = new FeatureLayer({
    url: "https://services.arcgis.com/F7DSX1DSNSiWmOqh/arcgis/rest/services/HUC10Watersheds_Maine/FeatureServer/0",
    visible: false,
    definitionExpression: "1=1",
    legendEnabled: false,
    listMode: "hide",
  });
  esri.webmap.add(esri.huc10);
  esri.mapView.on("click", function (event) {
    // Search for graphics at the clicked location. View events can be used
    // as screen locations as they expose an x,y coordinate that conforms
    // to the ScreenPoint definition.

    if (esri.highlightP) {
      esri.highlightP.remove();
      esri.highlightP = null;
    }
    esri.DSTrace.visible = false;
    esri.USTrace.visible = false;
    updateDetails({ Site_ID: "" });
    esri.mapView
      .hitTest(event, { include: [esri.layer] })
      .then(function (response) {
        if (response.results.length > 0) {
          let zoomLong = response.results[0].graphic.geometry.longitude;
          let zoomLat = response.results[0].graphic.geometry.latitude;
          let location = new Point(zoomLong, zoomLat);
          onSelectSite(response.results[0].graphic.attributes, location);
          //selected == "y";
        }
      });

    esri.mapView
      .hitTest(event, { include: [esri.huc8, esri.huc10] })
      .then(function (response) {
        if (response.results.length > 0 && !esri.highlightP) {
          let name = response.results[0].graphic.attributes.Name;
          geographyStore.searchTerm = name;
          console.log(response.results[0].graphic.geometry.extent);
          esri.mapView.goTo(response.results[0].graphic.geometry.extent);
        }
      });
  });

  if (esri.search) {
    esri.search.destroy();
    document.getElementById("searchDiv").innerHTML = "";
  }
  document.getElementById("searchDiv").innerHTML = "";
  esri.search = new Search({
    view: esri.mapView,
    container: "searchDiv",
    autoSelect: false,
    sources: [
      {
        layer: esri.layer,
        searchFields: ["Site_ID"],
        displayField: "Site_ID",
        exactMatch: false,
        outFields: ["*"],
        name: "All Barriers",
        placeholder: "Find Site by ID",
        maxResults: 6,
        maxSuggestions: 6,
        suggestionsEnabled: true,
        minSuggestCharacters: 0,
      },
    ],
    searchAllEnabled: false,
    includeDefaultSources: false,
    locationEnabled: false,
  });

  esri.search.on("search-clear", function (event) {
    if (esri.highlightP) {
      esri.highlightP.remove();
      esri.highlightP = null;
    }
    esri.DSTrace.visible = false;
    esri.USTrace.visible = false;
  });
  esri.search.on("search-complete", function (event) {
    let zoomLong = event.results[0].results[0].feature.geometry.longitude;
    let zoomLat = event.results[0].results[0].feature.geometry.latitude;
    let location = new Point(zoomLong, zoomLat);
    onSelectSite(event.results[0].results[0].feature.attributes, location);
  });

  //add scalebar widget

  //let scaleBar = new ScaleBar({
  //   view: esri.mapView,
  //  unit: "dual",
  //  id: "scale-bar",
  // });
  // esri.mapView.ui.add(scaleBar, {
  //  position: "bottom-right",
  // });

  //add measure tools
  esri.measurement = new Measurement({
    view: esri.mapView,
  });
  //esri.mapView.ui.add(esri.measurement, 'top-left')

  // create legend widget
  esri.legend = new Legend({
    view: esri.mapView,
  });
  esri.legend.respectLayerDefinitionExpression = true;
  // create expand widget to hide and show legend
  esri.lgExpand = new Expand({
    view: esri.mapView,
    content: esri.legend,
  });
  esri.lgExpand.expand();
  /*
  // specify layers to show in legend
  let layer = esri.map.layers.items.find((layer) => {
    return layer.type == 'map-image' && layer.url == store.supportingMapLayers[0].mapService
  })
  esri.legend.layerInfos = [
    {
      layer: layer,
      sublayerList: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21]
    }
  ]*/
  // add expand to map
  esri.mapView.ui.add(esri.lgExpand, "bottom-left");

  // move zoom controls to top right
  esri.mapView.ui.move(["zoom"], "top-left");

  //make call to query get all the stats
  getCount();
  //getHistogram('batTotUSDS')
  esriHistogram("US_SalmHabUnits");
});
</script>

<template>
  <div id="map" ref="map">
    <q-btn
      style="position: absolute; top: 10px; right: 10px"
      color="white"
      class="text-blue-grey-9"
      square=""
      size="sm"
      padding="10px"
      :icon="label ? 'check_circle' : 'radio_button_unchecked'"
      label="Show Label"
      @click="showLabels()"
      :ripple="false"
    ></q-btn>
    <q-btn
      v-if="infoPopupStore.details.Site_ID"
      style="position: absolute; top: 10px; right: 135px"
      color="white"
      class="text-blue-grey-9"
      square=""
      size="sm"
      padding="10px"
      label="Clear Selected"
      @click="clearSelected()"
      :ripple="false"
    ></q-btn>
  </div>
</template>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style>
@import "https://js.arcgis.com/4.20/@arcgis/core/assets/esri/themes/light/main.css";

#map {
  flex: 1;
  min-height: calc(100vh - 75px);
  height: 100%;
  width: 100%;
  position: relative;
}

@media screen and (max-width: 576px) {
  #map {
    min-height: 30vh;
    height: 100%;
    width: 100%;
    position: relative;
    border-bottom: #999 solid 1pt;
  }
}

#printBtn {
  position: absolute;
  z-index: 100;
  right: 15px;
  top: 175px;
  border: none;
  box-shadow: 1.5px 1.5px 1px 0px rgb(0 0 0 / 40%);
}
#toolbarDiv {
  position: absolute;
  left: 10px;
  top: 10px;
  display: flex;
  box-shadow: 0 1px 2px rgb(0 0 0 / 60%);
}

esri-expand__content esri-expand__content--expanded div {
  background-color: white;
}
#toolbarDiv button {
  border: unset;
}
#area {
  border-right: solid 1px rgba(110, 110, 110, 0.3) !important;
  border-left: solid 1px rgba(110, 110, 110, 0.3) !important;
}

.esri-widget--button.active,
.esri-widget--button.active:hover,
.esri-widget--button.active:focus {
  cursor: default;
  background-color: lightgrey;
}
.esri-widget--button.active path,
.esri-widget--button.active:hover path,
.esri-widget--button.active:focus path {
  fill: #e4e4e4;
}

.esri-widget *:focus-visible,
.esri-widget *:focus {
  outline: none !important;
}
</style>
<style>
.esri-legend {
  width: 160px !important;
}
.esri-legend__service h3 {
  line-height: unset;
}
.esri-legend__layer-cell {
  padding-top: 0;
  padding-bottom: 0;
}
.esri-measurement {
  margin: 40px 0 0 -4px;
}
.esri-ui-corner .esri-component,
.esri-expand__content {
  box-shadow: 1px 1px 2px rgb(0 0 0 / 60%);
}

.esri-scale-bar__line {
  background-color: white !important;
}

.esri-layer-list__item-content {
  font-size: 13px;
  font-family: "roboto";
}

‍‍‍‍‍‍ #viewDiv {
  padding: 0;
  margin: 0;
  height: 100%;
  width: 100%;
}

#controls {
  width: 500px;
}

#outer-container {
  padding: 15px;
  width: 500px;
}

#description {
  padding: 10px 10px 0px 10px;
  font-size: 14pt;
}

#titleDiv {
  padding: 10px;
}

#titleText {
  font-size: 20pt;
  font-weight: 60;
  padding-bottom: 10px;
}
.esri-widget *:focus-visible,
.esri-widget *:focus {
  outline: none !important;
}
</style>
